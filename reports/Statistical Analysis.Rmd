---
title: "Statistical Analysis"
author: "Lyttia Cancinos-McManus"
date: "September 2, 2018"
output: html_document
---
```{r}
library(tidyverse)
crimes4 <- read.csv("crimes4.csv")
```

1. Counts:
Total number of crimes per zip code, ordered from highest crime count to lowest.Someone buying property might be interested in this plot.
```{r}
crime_count_by_zip <- crimes4 %>% count(zipcode)
crime_count_by_zip
zipcodes <- table(crimes4$zipcode)
zipcodes
barplot(zipcodes[order(zipcodes, decreasing = TRUE)])
```

Total number of each category of crime. 
```{r}
crime_count_by_category <- crimes4 %>% count(category)
crime_count_by_category
categories <- table(crimes4$category)
ordered_categories <- categories[order(categories, decreasing = TRUE)]
barplot(ordered_categories)
```

Total number of each category of crime in zip code with highest crime count. 
```{r}
crimes85015 <- crimes4 %>% filter(zipcode == 85015)
crimes85015 %>% count(category)
categories85015 <- table(crimes85015$category)
barplot(categories85015[order(categories85015, decreasing = TRUE)])
```

Number of crimes each month in 2017 and 2016. 
```{r}
crimes2017 <- crimes4 %>% filter(year == 2017)
crimes2016 <- crimes4 %>% filter(year == 2016)
crimes2017 %>% count(month)
crimes2016 %>% count(month)
months2017RC <- table(crimes2017$monthRC)
months2017 <- table(crimes2017$month)
months2016RC <- table(crimes2016$monthRC)
months2016 <- table(crimes2016$month)
barplot(months2017)
barplot(months2016)
barplot(months2017RC[order(months2017RC, decreasing = TRUE)])
barplot(months2016RC[order(months2016RC, decreasing = TRUE)])

# Tally by month the dplyr way
group_by(crimes2017, monthRC) %>%
    summarise(count = n()) %>%
    arrange(desc(count))

group_by(crimes2016, monthRC) %>%
    summarise(count = n()) %>%
    arrange(desc(count))
```

2. Trends (high, low, increase, decrease, anomalies):

Zip code 85015 has the highest crime count at almost 9000 crimes (8965).

Multiple zip codes have only 1 crime... should these zips be included? 

A map would better show where the crimes are being reported and trends, but I do not have exact locations (lat/long).

Crime count seems to be between 5,000-5,500 each month.

3. Bar plot/ histogram:
```{r}
# install.packages("ggplot2")
library(ggplot2)
```

```{r}
my_theme <- theme_bw() +
    theme(panel.border = element_blank(),
          axis.ticks = element_blank(),
          panel.grid.minor = element_blank(),
          panel.grid.major.x = element_blank(),
          panel.grid.major.y = element_line(size = 0.5),
          axis.title = element_text(colour = "grey40"),
          plot.title = element_text(vjust = 2.0))

ggplot(data = crimes2017, aes(x = monthRC)) + 
    my_theme +
    geom_bar(stat = "count", fill = "lightblue", width = 0.75) +
    ggtitle("Total Crimes by Month in 2017") +
    xlab(NULL) +
    ylab("Total Crime Count")

ggsave("total_crimes_by_month2017.png")
```

Are any categories more prevelant at a certain time of the month?

Does overall crime count increase or decrease as property values increase?
Property values need to be binned. 
```{r}

```

4. Comparisons:
Compare the amounts of crimes in each zip code ordered by property value.

```{r}
barplot(zipcodes[order(crimes4$median_value, decreasing = TRUE)])
```

Scatterplots:

```{r}

```

5. Can you make a time-series plot?

```{r}
# Subset the data for the less frequent categories
sub <- levels(ordered_categories)[1:4] # Create a subseting object
temp <- filter(crimes4, category %in% sub) # Subset using dplyr

# Make plot
ggplot(temp, aes(x = monthRC, color = category, group = category)) +
    my_theme +
    geom_line(stat = "bin", size = 1) +
    ggtitle("Crimes by Month - Less Frequent Categories") +
    xlab(NULL) +
    ylab("Crime Count")

# Do another subset for the more frequent categories
sub <- levels(ordered_categories)[5:7]
temp <- filter(crimes4, category %in% sub)

# Make second plot
ggplot(temp, aes(x = monthRC, color = category, group = category)) + 
    my_theme +
    geom_line(stat = "bin", size = 1) +
    ggtitle("Crime by Month - More Frequent Categories") +
    xlab(NULL) +
    ylab("Crime Count")
```

6.Having made these plots, what are some insights you get from them? Do you see any correlations? Is there a hypothesis you would like to investigate further? What other questions do they lead you to ask?

Limitations: 
Accounts only for crimes reported to Phoenix PD. There may be many other crimes reported to surrounding cities PDs. Would my model be more accurate if I only included zip codes located in Phoenix boundaries?

